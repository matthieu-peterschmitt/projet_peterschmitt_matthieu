@if (!isFormSubmitted()) {
  <div class="pollution-form-container">
    <h2>{{ isEditMode() ? 'Modifier la Pollution' : 'D√©claration de Pollution' }}</h2>

    @if (errorMessage()) {
      <div class="error-alert">
        {{ errorMessage() }}
      </div>
    }

    <form [formGroup]="pollutionForm" (ngSubmit)="onSubmit()" class="pollution-form">
      <div class="form-group">
        <label for="titre">Titre de la pollution</label>
        <input
          type="text"
          id="titre"
          formControlName="titre"
          class="form-control"
          [class.invalid]="isFieldInvalid('titre')"
          placeholder="Ex: D√©versement d'huile dans la rivi√®re"
        />
        @if (isFieldInvalid('titre')) {
          <div class="error-message">
            {{ getFieldError('titre') }}
          </div>
        }
      </div>

      <div class="form-group">
        <label for="type">Type de pollution</label>
        <select
          id="type"
          formControlName="type"
          class="form-control"
          [class.invalid]="isFieldInvalid('type')"
        >
          <option value="">S√©lectionnez un type</option>
          @for (type of pollutionTypes; track type) {
            <option [value]="type">
              {{ type }}
            </option>
          }
        </select>
        @if (isFieldInvalid('type')) {
          <div class="error-message">
            {{ getFieldError('type') }}
          </div>
        }
      </div>

      <div class="form-group">
        <label for="description">Description</label>
        <textarea
          id="description"
          formControlName="description"
          class="form-control"
          [class.invalid]="isFieldInvalid('description')"
          rows="4"
          placeholder="D√©crivez en d√©tail la pollution observ√©e..."
        ></textarea>
        @if (isFieldInvalid('description')) {
          <div class="error-message">
            {{ getFieldError('description') }}
          </div>
        }
      </div>

      <div class="form-group">
        <label for="dateObservation">Date de l'observation</label>
        <input
          type="date"
          id="dateObservation"
          formControlName="dateObservation"
          class="form-control"
          [class.invalid]="isFieldInvalid('dateObservation')"
        />
        @if (isFieldInvalid('dateObservation')) {
          <div class="error-message">
            {{ getFieldError('dateObservation') }}
          </div>
        }
      </div>

      <div class="form-group">
        <label for="lieu">Lieu</label>
        <input
          type="text"
          id="lieu"
          formControlName="lieu"
          class="form-control"
          [class.invalid]="isFieldInvalid('lieu')"
          placeholder="Ex: Parc de la Villette, Paris"
        />
        @if (isFieldInvalid('lieu')) {
          <div class="error-message">
            {{ getFieldError('lieu') }}
          </div>
        }
      </div>

      <div class="coordinates-group">
        <div class="form-group">
          <label for="latitude">Latitude</label>
          <input
            type="number"
            id="latitude"
            formControlName="latitude"
            class="form-control"
            [class.invalid]="isFieldInvalid('latitude')"
            step="0.000001"
            placeholder="Ex: 48.8566 (entre -90 et 90)"
            min="-90"
            max="90"
          />
          @if (isFieldInvalid('latitude')) {
            <div class="error-message">
              {{ getFieldError('latitude') }}
            </div>
          }
        </div>

        <div class="form-group">
          <label for="longitude">Longitude</label>
          <input
            type="number"
            id="longitude"
            formControlName="longitude"
            class="form-control"
            [class.invalid]="isFieldInvalid('longitude')"
            step="0.000001"
            placeholder="Ex: 2.3522 (entre -180 et 180)"
            min="-180"
            max="180"
          />
          @if (isFieldInvalid('longitude')) {
            <div class="error-message">
              {{ getFieldError('longitude') }}
            </div>
          }
        </div>
      </div>

      <div class="form-group">
        <label for="photo">Photo de la pollution</label>
        <input
          type="file"
          id="photo"
          (change)="onFileSelected($event)"
          class="form-control"
          accept="image/jpeg,image/jpg,image/png,image/gif,image/webp,image/bmp"
        />
        @if (selectedFileName()) {
          <div class="file-info">
            üìé Fichier s√©lectionn√© : {{ selectedFileName() }}
          </div>
        }
        @if (photoPreview()) {
          <div class="photo-preview">
            <img [src]="photoPreview()" alt="Aper√ßu de la photo" />
            <button type="button" class="remove-photo-btn" (click)="removePhoto()">
              ‚úï Supprimer la photo
            </button>
          </div>
        }
        <small class="form-text"
          >Optionnel - Formats support√©s : JPEG, PNG, GIF, WEBP, BMP (Max 5 MB)</small
        >
      </div>

      <div class="form-actions">
        <button
          type="submit"
          class="btn btn-primary"
          [disabled]="pollutionForm.invalid || isLoading()"
        >
          @if (isLoading()) {
            Traitement...
          } @else {
            {{ isEditMode() ? 'Mettre √† jour' : 'D√©clarer' }}
          }
        </button>
        <button
          type="button"
          class="btn btn-secondary"
          (click)="pollutionForm.reset()"
          [disabled]="isLoading()"
        >
          R√©initialiser
        </button>
      </div>
    </form>
  </div>
}

@if (isFormSubmitted()) {
  <div class="success-message">
    <div class="success-content">
      <div class="success-icon">‚úÖ</div>
      <h2>
        {{
          isEditMode()
            ? 'Pollution mise √† jour avec succ√®s!'
            : 'D√©claration enregistr√©e avec succ√®s!'
        }}
      </h2>
      <p>
        {{
          isEditMode()
            ? 'Les modifications ont √©t√© sauvegard√©es.'
            : 'Votre d√©claration de pollution a √©t√© enregistr√©e.'
        }}
      </p>
      <p class="redirect-info">Redirection en cours...</p>
    </div>
  </div>
}
